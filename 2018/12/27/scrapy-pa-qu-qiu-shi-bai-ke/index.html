<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    

<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Scrapy爬取糗事百科, 程序员小黑">
    <meta name="description" content="结果展示{&amp;quot;author&amp;quot;: &amp;quot;毒男·i&amp;quot;, &amp;quot;content&amp;quot;: &amp;quot;\n\n\n在医院里，我和老婆抱着孩子去看病。老婆说：“你说女人要不要学一点防狼术。”我说：“需要啊">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Scrapy爬取糗事百科 | 程序员小黑</title>
    <link rel="icon" type="image/png" href="/ICO.ico">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

</head>

<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="container">
            <div class="nav-wrapper">
                <div class="brand-logo">
                    <a href="/" class="waves-effect waves-light">
                        
                        <img src="/medias/logo.png" class="logo-img hide-on-small-only">
                        
                        <span class="logo-span">程序员小黑</span>
                    </a>
                </div>
                <a href="#" data-activates="mobile-nav" class="button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于我</span>
        </a>
    </li>
    
    <li>
        <a id="toggleSearch" class="waves-effect waves-light">
            <i id="searchIcon" class="mdi-action-search"></i>
        </a>
    </li>

</ul>

<div class="side-nav" id="mobile-nav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">程序员小黑</div>
        <div class="logo-desc">
            
            别人了解你有趣灵魂的前提是自己有一个好看的皮囊💪
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于我
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>

    <div class="social-link"><a href="https://github.com/liu726301387" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
    <i class="fa fa-github"></i>
</a>
<a href="mailto:this.liu@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
    <i class="fa fa-envelope-open"></i>
</a>
<a href="#!" class="tooltipped" data-tooltip="QQ联系我: 726301387" data-position="top" data-delay="50">
    <i class="fa fa-qq"></i>
</a>

<a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
    <i class="fa fa-rss"></i>
</a>
</div>
</div>

            </div>
        </div>

        
        <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewbox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
    </svg>
</a>
        
    </nav>
</header>



<div class="bg-cover post-cover" style="background-image: url('http://m.qpic.cn/psb?/V10Lajvl1FgUNv/PPWwoLRM4bzhkfUzCwJU5MdXYSnbp0s9dmORMQAIUDs!/b/dDQBAAAAAAAA&bo=CwU4BAAAAAARBwI!&rf=viewer_4')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        Scrapy爬取糗事百科
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="container content">

    
    <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            
            <div class="article-tag">
                
                <a href="/tags/Python爬虫/" target="_blank">
                    <span class="chip bg-color">Python爬虫</span>
                </a>
                
                <a href="/tags/Scrapy/" target="_blank">
                    <span class="chip bg-color">Scrapy</span>
                </a>
                
            </div>
            
            <div class="post-info">
                
                <span class="post-cate">
                    <i class="fa fa-bookmark fa-fw icon-category"></i>
                    
                    <a href="/categories/Python/" class="post-category" target="_blank">
                        Python
                    </a>
                    
                </span>
                

                <span class="post-date">
                    <i class="fa fa-clock-o fa-fw"></i>2018-12-27
                </span>
            </div>
        </div>
        <hr>
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="结果展示"><a href="#结果展示" class="headerlink" title="结果展示"></a>结果展示</h1><pre><code>{&quot;author&quot;: &quot;毒男·i&quot;, &quot;content&quot;: &quot;\n\n\n在医院里，我和老婆抱着孩子去看病。老婆说：“你说女人要不要学一点防狼术。”我说：“需要啊。”老婆说：“假如我身边有一只狼，动不动就欺负我，该怎么办。”我说：“我来教训他。”老婆说：“老公你对我真好。”我说：“那当然了。”老婆说：“那好，你去前面男科，把自己结扎了。”我说：“为啥。”老婆说：“就是你这头狼，动不动就把持不住自己，我又害怕做人流，我首先得防你啊！”\n\n&quot;}
{&quot;author&quot;: &quot;没钱啊！糗大了。&quot;, &quot;content&quot;: &quot;\n\n\n这女人真是惹不起，公司张总老去骚扰出纳员，弄的她打也不是骂也不是，结果这回开支，我们都是面额100元的，出纳尽然把他弟弟做买卖的零钱，拿来给张总开支，都是一元五元的，好吗，几万块足足两大方便袋，出纳说在骚扰我，下回开支就都是一元的硬币，把我们笑的肚子都疼。\n\n&quot;}
{&quot;author&quot;: &quot;无书斋主&quot;, &quot;content&quot;: &quot;\n\n\n中午我做饭的时间，放在客厅的电话响了，我问老婆谁？老婆看了下是陌生电话……我叫按免提帮接下……老婆接后说了声:喂，你好……那边停顿大约五秒后:一个男声说，我爱你！！！\n\n&quot;}
{&quot;author&quot;: &quot;胖香&quot;, &quot;content&quot;: &quot;\n\n\n老妈说老家二楼顶子好像漏雨，让我哥趁没上冻回去给补补，我哥总说忙，我搭了一句话:“这点小事，我这女汉子出马分分钟搞定！”我妈考虑了一下跟我说:“别了，冬天也没大雨，你要是上去修不好再压一下，我怕到时候屋里飘雪花……”\n\n&quot;}
{&quot;author&quot;: &quot;孙小欠儿&quot;, &quot;content&quot;: &quot;\n\n\n晚上躺床上问媳妇儿“嗲”怎么写，媳妇儿说那么简单的字都不会写‘这边一个口那边一个爹’我A了一声…………然后就在床下啦\n\n&quot;}
{&quot;author&quot;: &quot;聊天不撩妹子&quot;, &quot;content&quot;: &quot;\n\n\n小侄女初中毕业就不读书了，天天在家玩游戏，什么事也不做，堂哥让我给找个班上。公司边上刚好有家食品厂招人，就介绍她去了。昨天厂里发工资，我问她拿了多少钱。她说发六百多。我问她说试用期工资也不可能这么低吧，要不换个厂上班去。她说才不换呢，厂里生产的都是我爱吃的，一个月我都长高两公分了。长高没长高我不知道，反正脸蛋园了\n\n&quot;}
{&quot;author&quot;: &quot;陌年微凉-&quot;, &quot;content&quot;: &quot;\n\n\n自从交了女朋友我才知道，原来口红有正红，枫叶红，玫瑰红！护肤的有精华液，爽肤水，补水乳还有面霜，眼霜，唇膜！并且我还知道了，男朋友可以有好几个，暖床的，付钱的，无聊的时候陪玩的～\n\n&quot;}
{&quot;author&quot;: &quot;无书斋主&quot;, &quot;content&quot;: &quot;\n\n\n小舅子四岁的女儿在我家吃晚饭，做特意做了她喜欢吃的虾和牛肉，她很懂事，一个劲的说谢谢姑爸爸（姑父的意思）……舅子来接她的时间，我说喜欢吃姑爸爸做的菜，就住姑爸爸家里好不？不好不好，姑爸爸刚给姑姑说,说我又吃了他们一个星期的生活费，要姑姑早点把我送回去，现在说要我住，骗人……我去，这让我怎么接？？\n\n&quot;}
{&quot;author&quot;: &quot;雷霆万钧～&quot;, &quot;content&quot;: &quot;\n\n\n在丈母娘家吃饭，丈母娘跟老丈人赌气没吃饭，吃过饭跟老丈人下棋，老丈人明显心不在焉，看了看在餐桌旁边转悠的丈母娘，放下棋子就去了厕所，回来没下一会，又去了厕所。我跟丈母娘说：爸是不是肚子不舒服？要不要我去给他买点药？丈母娘白了我一眼：你爸知道我馋那猪蹄了，又不好意思吃，就特意去厕所，让我偷吃，谁知道你这傻小子傻楞在这不走了！\n\n&quot;}
{&quot;author&quot;: &quot;传说中的谢漂亮&quot;, &quot;content&quot;: &quot;\n\n\n今天剑大哥发表了一动态。。丈母娘，是时候发货啦！要不然只给一星评价了。。。\n\n&quot;}
{&quot;author&quot;: &quot;老巫婆～～&quot;, &quot;content&quot;: &quot;\n\n\n表弟去相亲，第一次女方问表弟“谈过恋爱吗？”表弟说：没谈过！女方嫌弃地走了，说是没有恋爱经验的不要！第二次女方问表弟“谈过恋爱吗？”这次表弟学乖了说：“有，谈了好几次恋爱了！”女方又嫌弃地走了，说表弟是花心大萝卜…第三次表弟变被动为主动，抢先问对方有没有谈过恋爱。结果女方嫌弃他说话太直白不够委婉，也…也走了…\n\n&quot;}
{&quot;author&quot;: &quot;渣渣婉儿&quot;, &quot;content&quot;: &quot;\n\n\n男朋友说我卸了妆能过万圣节，我笑了，你脱了裤子能过儿童节～\n\n&quot;}
{&quot;author&quot;: &quot;胖香&quot;, &quot;content&quot;: &quot;\n\n\n女儿考试被老师表扬，回家我很高兴的跟她说:“你想要什么奖励？”她兴奋的说:“上次大姨给小弟弟剃了光头，那个脑袋摸着好舒服，你能剃光给我摸吗？！”\n\n&quot;}
{&quot;author&quot;: &quot;918疯狂英子&quot;, &quot;content&quot;: &quot;\n\n\n姐姐结婚的时候我都没空回去，都不知姐夫张啥样，今年回家顺道去姐姐家玩，打个的，师傅猥琐的眼神说很远的某某小区八十！去到姐姐家我才知道被坑了，吃饭的时候姐夫回来了，你能想象我看到姐夫就是那个出租车师傅时的表情吗？当晚他就被姐姐赶出房间睡大厅\n\n&quot;}
{&quot;author&quot;: &quot;找女友的单身猪&quot;, &quot;content&quot;: &quot;\n\n\n一旦你们公司装上了打卡机，就意味着你们的公司不行了，你们的老板思想迂腐，终究是个穷逼公司，早走早发财。\n\n&quot;}
{&quot;author&quot;: &quot;醉酒舞剑砍疯子.&quot;, &quot;content&quot;: &quot;\n\n\n昨天，带着我家二哈去钓鱼，我静静的坐在河边，傻狗在河沿上到处撒欢跑！突然有鱼上钩，我快速起竿收线，一看，哇～！一条二斤多的鲤鱼，我把鱼放进水桶里，兴奋的喊二哈来看我的收获！二哈听见我喊它，呼呼的朝我奔来！结果这傻狗没刹住，把我的水桶撞翻了，正好滚到河里！\n\n&quot;}
{&quot;author&quot;: &quot;奔跑的小土狼&quot;, &quot;content&quot;: &quot;\n\n\n公司成立八周年！老板请吃饭，跟他坐一桌的除了秘书，全是销售部那些精英小伙子们，副总、经理都得靠边站小周在我线上干活儿，这小子一点儿拼劲儿都没有我对他说：你要能坐到那个桌上去，在咱们厂就算个人物了小周：咱老板不要男秘书吧\n\n&quot;}
{&quot;author&quot;: &quot;无书斋主&quot;, &quot;content&quot;: &quot;\n\n\n昨天单位小刘来办公室给我说:正叔，你帮我个忙，我今天相亲，对方会带爸妈来，你就当我两个小时的爸爸好不好？拜托了……我想想答应了……到了小刘约定的地方，对面一个二十多的小哥看着我问小刘:这就是你喜欢的老鬼？迎面就是一拳……不是我有点功夫底子，估计会被打死！！\n\n&quot;}
{&quot;author&quot;: &quot;爱新觉罗.黄瓜&quot;, &quot;content&quot;: &quot;\n\n\n每次惹老婆生气，她都会去厨房拍鸡蛋撒气，完事后将鸡蛋残 渣收集起来，做一碗鸡蛋羹，亲手喂给我吃！她喂我鸡蛋羹时，嘴里还振振有词:“你个大坏蛋！我拍死你，烫死你，咸死你！”在亲朋好友眼中这是秀恩爱，而在我心里，这只不过又是一次恶作剧式的惩 罚！\n\n&quot;}
{&quot;author&quot;: &quot;=正在中最&quot;, &quot;content&quot;: &quot;\n\n\n有一回，有个人欠揍，于是，我想打他可打不到，他刚想往前伸头结果我想做个样子，啪的一声，牙都掉了\n\n&quot;}
{&quot;author&quot;: &quot;老巫婆～～&quot;, &quot;content&quot;: &quot;\n\n\n医生从病房出来后，我赶紧冲上去，抓起医生的手急切的问到:“医生，他怎么样？他会不会死啊？”医生不急不缓的说:“病人目前没什么大碍，只是你下手重了点，把他打晕了！”我深深的舒了口气，前男友约我今晚见面，用擀面杖把他打晕了我也是 逼 不 得已~\n\n&quot;}
{&quot;author&quot;: &quot;毒男·i&quot;, &quot;content&quot;: &quot;\n\n\n媳妇和大姨子是双胞胎，媳妇在家一边抱着出生不久的小外甥，一边当我面埋怨她双胞胎姐姐：“别人都说双胞胎好，我就不这样认为！”我补充说：“双胞胎多好啊！从小就不孤单，可以互相替上班，替上学，多让人羡慕啊！”媳妇把小外甥放在旁边：“对！也就我那二货姐姐能想出来，她去度假，让我在家骗他孩子当他妈妈！”\n\n&quot;}
{&quot;author&quot;: &quot;挖鼻孔的老虎&quot;, &quot;content&quot;: &quot;\n\n\n半夜回家经过一条巷子，看到一只兔子蹲在墙角，忍不住去摸一摸它。我到现在都特么想不明白，究竟什么样的人会给流浪狗戴上兔耳朵？\n\n&quot;}
{&quot;author&quot;: &quot;恨钱不成山&quot;, &quot;content&quot;: &quot;\n\n\n跟朋友去某四儿子店看车，朋友跟店员砍价，店员说说做不了主，要跟经理请示一下！于是他用手机拨通了经理的电话，就在店员跟经理热火朝天商量价格的时候，突然～店员的手机响起了音乐\n\n&quot;}
{&quot;author&quot;: &quot;天山无情剑&quot;, &quot;content&quot;: &quot;\n\n\n她妈的，糗百里这个糖糖怎么天天都在，你是哪个鬼\n\n&quot;}
</code></pre><h1 id="新建Scrapy项目"><a href="#新建Scrapy项目" class="headerlink" title="新建Scrapy项目"></a>新建Scrapy项目</h1><pre><code>scrapy startproject 项目名称
scrapy startproject QiuShiBaiKe
</code></pre><h2 id="项目目录解析"><a href="#项目目录解析" class="headerlink" title="项目目录解析"></a>项目目录解析</h2><pre><code>L:.
│  scrapy.cfg
│  start.py
│  Test.py
│  Test2.py
│
└─QiuShiBaiKe        # 项目文件夹
    │  items.py        # 用来存放爬虫爬取下来数据的模型
    │  middlewares.py    # 中间件文件
    │  pipelines.py        # 用来将Items的模型存储到本地磁盘中
    │  QiuShiBaiKe.json
    │  settings.py        # 本爬虫的一些配置信息(请求头,ip代理池等配置)
    │  __init__.py
    │
    ├─spiders
    │  │  QiuShi.py        # 爬虫文件,运行scrapy genspider 命令自动生成的文件
    │  │  __init__.py
</code></pre><h2 id="创建一个爬虫"><a href="#创建一个爬虫" class="headerlink" title="创建一个爬虫"></a>创建一个爬虫</h2><pre><code>scrapy genspider QiuShi &quot;qiushibaike.com&quot;
</code></pre><h2 id="运行Scrapy-使用Python脚本运行Scrapy项目"><a href="#运行Scrapy-使用Python脚本运行Scrapy项目" class="headerlink" title="运行Scrapy(使用Python脚本运行Scrapy项目)"></a>运行Scrapy(使用Python脚本运行Scrapy项目)</h2><p>运行Scrapy项目,需要在终端下进入项目的根目录,然后执行Scrapy crawl [爬虫名字],如果不想每次都在终端运行可以把这个命令写在一个Python脚本文件中,然后再Pycharm中运行脚本即可.</p>
<p>新建一个Start.py的文件,然后写入以下代码.</p>
<pre><code>from scrapy import cmdline

cmdline.execute(&quot;scrapy crawl QiuShi&quot;.split())
</code></pre><p>scrapy crawl <strong>QiuShi(这里是爬虫名字,而不是Scrapy项目的名字)</strong></p>
<h1 id="版本一-完成简单的爬取并将数据保存成JSON格式"><a href="#版本一-完成简单的爬取并将数据保存成JSON格式" class="headerlink" title="版本一:完成简单的爬取并将数据保存成JSON格式"></a>版本一:完成简单的爬取并将数据保存成JSON格式</h1><p>QiuShi.py</p>
<pre><code># -*- coding: utf-8 -*-
import scrapy
from QiuShiBaiKe.items import QiushibaikeItem
from scrapy.http.response.html import HtmlResponse


class QiushiSpider(scrapy.Spider):
    name = &#39;QiuShi&#39;
    allowed_domains = [&#39;qiushibaike.com&#39;]  # 爬虫域限制域
    start_urls = [&#39;https://www.qiushibaike.com/text/page/1/&#39;]  # 开始的URL

    def parse(self, response):
        outerbox = response.xpath(&quot;//div[@id=&#39;content-left&#39;]/div&quot;)  # 使用Scrapy内置的xpath进行元素怒的选择
        for box in outerbox:
            # 提取作者和内容
            author = box.xpath(&quot;.//h2/text()&quot;).extract_first().strip()
            content = box.xpath(&quot;.//div[@class=&#39;content&#39;]/span/text()&quot;).getall()
            content = &#39;&#39;.join(content)
            items = QiushibaikeItem(author=author, content=content)
            yield items  # 生成器,只要一个函数中有yield那么他就不是一个普通的函数了,而是一个生成器.
</code></pre><p>items.py</p>
<pre><code># -*- coding: utf-8 -*-

# Define here the models for your scraped items
#
# See documentation in:
# https://doc.scrapy.org/en/latest/topics/items.html

# Item定义数据模型

import scrapy


class QiushibaikeItem(scrapy.Item):
    author = scrapy.Field()
    content = scrapy.Field()
</code></pre><p>middlewares.py</p>
<p>初始文件并未改动</p>
<p>piplines.py</p>
<pre><code># -*- coding: utf-8 -*-

# Define your item pipelines here
#
# Don&#39;t forget to add your pipeline to the ITEM_PIPELINES setting
# See: https://doc.scrapy.org/en/latest/topics/item-pipeline.html

# Piplines用来将Item的数据模型存储到硬盘中
import json


class QiushibaikePipeline(object):
    &#39;&#39;&#39;将item的数据模型存储到JSON文件中&#39;&#39;&#39;

    def __init__(self):
        # 创建文件对象
        self.fileproject = open(&#39;QiuShiBaiKe.json&#39;, &#39;w&#39;, encoding=&#39;utf-8&#39;)  # 打开文件

    def open_spider(self, spider):
        print(&#39;*&#39; * 50)
        print(&#39;Piplines开始保存数据&#39;)
        print(&#39;*&#39; * 50)

    def process_item(self, item, spider):
        &#39;&#39;&#39;处理item,写入文件&#39;&#39;&#39;
        item_json = json.dumps(dict(item),ensure_ascii=False)         # 将item传过来的数据,转换成JSON,ensure_ascii为False才能转换成中文
        self.fileproject.write(item_json + &quot;\n&quot;)
        return item

    def close_spider(self, spider):
        &#39;&#39;&#39;关闭爬虫&#39;&#39;&#39;
        self.fileproject.close()
        print(&#39;*&#39; * 50)
        print(&#39;Piplines结束保存数据&#39;)
        print(&#39;*&#39; * 50)
</code></pre><p>settings.py</p>
<pre><code>BOT_NAME = &#39;QiuShiBaiKe&#39;

SPIDER_MODULES = [&#39;QiuShiBaiKe.spiders&#39;]
NEWSPIDER_MODULE = &#39;QiuShiBaiKe.spiders&#39;
# 是否遵守爬虫协议,改为False
ROBOTSTXT_OBEY = False        
# 添加请求头
DEFAULT_REQUEST_HEADERS = {
    &#39;Accept&#39;: &#39;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#39;,
    &#39;Accept-Language&#39;: &#39;en&#39;,
    &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:65.0) Gecko/20100101 Firefox/65.0&#39;,
}

# 开启ITEM_PIPELINES
# 后面的Value是指优先级
ITEM_PIPELINES = {
    &#39;QiuShiBaiKe.pipelines.QiushibaikePipeline&#39;: 300,
}
</code></pre><h1 id="版本-二-优化数据存储方式-一-使用JsonItemExporter存储数据"><a href="#版本-二-优化数据存储方式-一-使用JsonItemExporter存储数据" class="headerlink" title="版本(二)优化数据存储方式(一)使用JsonItemExporter存储数据"></a>版本(二)优化数据存储方式(一)使用JsonItemExporter存储数据</h1><p>其他文件不变,piplines文件修改如下</p>
<p>piplines.py</p>
<pre><code>from scrapy.exporters import JsonItemExporter       # Scrapy内置的JSON导出模块

class QiushibaikePipeline(object):
    &#39;&#39;&#39;将item的数据模型存储到JSON文件中&#39;&#39;&#39;
    def __init__(self):
        # 创建文件对象
        self.fileproject = open(&#39;QiuShiBaiKe.json&#39;, &#39;wb&#39;)  # 以二进制的方式打开文件
        self.exportar = JsonItemExporter(self.fileproject,ensure_ascii=False,encoding=&#39;utf-8&#39;)
        self.exportar.start_exporting()     # 开始导出



    def open_spider(self, spider):
        print(&#39;*&#39; * 50)
        print(&#39;Piplines开始保存数据&#39;)
        print(&#39;*&#39; * 50)

    def process_item(self, item, spider):
        &#39;&#39;&#39;处理item,写入文件&#39;&#39;&#39;
        self.exportar.export_item(item)
        return item

    def close_spider(self, spider):
        &#39;&#39;&#39;关闭爬虫&#39;&#39;&#39;
        self.exportar.finish_exporting()        # 完成导入
        self.fileproject.close()
        print(&#39;*&#39; * 50)
        print(&#39;Piplines结束保存数据&#39;)
        print(&#39;*&#39; * 50)
</code></pre><p>这种存储json文件的方式有个弊端,就是<strong>它会将所有的JSON数据都保存到一个列表中,非常消耗内存,适合数据量比较小的项目</strong></p>
<h1 id="版本-三-优化数据存储的方式-二-使用JsonLinesItemExporter存储数据"><a href="#版本-三-优化数据存储的方式-二-使用JsonLinesItemExporter存储数据" class="headerlink" title="版本(三)优化数据存储的方式(二)使用JsonLinesItemExporter存储数据"></a>版本(三)优化数据存储的方式(二)使用JsonLinesItemExporter存储数据</h1><p>修改piplines,其他代码不变</p>
<pre><code># -*- coding: utf-8 -*-
# Piplines用来将Item的数据模型存储到硬盘中

from scrapy.exporters import JsonLinesItemExporter  # Scrapy内置的JSON导出模块


class QiushibaikePipeline(object):
    &#39;&#39;&#39;将item的数据模型存储到JSON文件中&#39;&#39;&#39;

    def __init__(self):
        # 创建文件对象
        self.fileproject = open(&#39;QiuShiBaiKe.json&#39;, &#39;wb&#39;)  # 以二进制的方式打开文件
        self.exportar = JsonLinesItemExporter(self.fileproject, ensure_ascii=False, encoding=&#39;utf-8&#39;)

    def open_spider(self, spider):
        print(&#39;*&#39; * 50)
        print(&#39;Piplines开始保存数据&#39;)
        print(&#39;*&#39; * 50)

    def process_item(self, item, spider):
        &#39;&#39;&#39;处理item,写入文件&#39;&#39;&#39;
        self.exportar.export_item(item)
        return item

    def close_spider(self, spider):
        &#39;&#39;&#39;关闭爬虫&#39;&#39;&#39;
        self.fileproject.close()
        print(&#39;*&#39; * 50)
        print(&#39;Piplines结束保存数据&#39;)
        print(&#39;*&#39; * 50)
</code></pre><p>这种存储JSON的方法是以1条数据一行的形式,<strong>每一行是一个JSON,适合数据量比较大的项目</strong></p>
<h1 id="多页面抓取"><a href="#多页面抓取" class="headerlink" title="多页面抓取"></a>多页面抓取</h1><p>修改setting.py</p>
<p>将下载延迟修改成1,下载之前等待1秒钟.</p>
<pre><code>DOWNLOAD_DELAY = 1
</code></pre><p>修改Qiushi.py,完成多页面爬取</p>
<pre><code># -*- coding: utf-8 -*-
import scrapy
from QiuShiBaiKe.items import QiushibaikeItem
from scrapy.http.response.html import HtmlResponse


class QiushiSpider(scrapy.Spider):
    name = &#39;QiuShi&#39;
    allowed_domains = [&#39;qiushibaike.com&#39;]  # 爬虫域限制域
    start_urls = [&#39;https://www.qiushibaike.com/text/page/1/&#39;]  # 开始的URL
    base_domain =&#39;https://www.qiushibaike.com&#39;

    def parse(self, response):
        outerbox = response.xpath(&quot;//div[@id=&#39;content-left&#39;]/div&quot;)  # 使用Scrapy内置的xpath进行元素怒的选择
        for box in outerbox:
            # 提取作者和内容
            author = box.xpath(&quot;.//h2/text()&quot;).extract_first().strip()
            content = box.xpath(&quot;.//div[@class=&#39;content&#39;]/span/text()&quot;).getall()
            content = &#39;&#39;.join(content)
            items = QiushibaikeItem(author=author, content=content)
            yield items  # 生成器,只要一个函数中有yield那么他就不是一个普通的函数了,而是一个生成器.
        # 当yield 返回当前item之后然后再去爬取下一页的链接
        next_url = response.xpath(&quot;//ul[@class=&#39;pagination&#39;]/li[last()]/a/@href&quot;).get()  # 得到下一页的url
#       print(next_url)     # /text/page/2/
        if not next_url:
            return
        else:
            # 这个Request类中需要注意:
            # 第一个参数是请求的url
            # 第二个参数是如果请求的url成功,之后需要执行哪个函数
            # 总的来说就是:去请求url,如果请求成功,那么就调用方法去解析请求回来的页面
            yield scrapy.Request(self.base_domain+next_url, callback=self.parse)
</code></pre><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><strong>Scrapy框架支持9种数据的导出.具体参考scrapy.exporters</strong></p>
<p><img src="http://m.qpic.cn/psb?/V10Lajvl1FgUNv/ZuEzizylr1OuTFsfNbmnHCjXJ29s*jW7qfxaRnHeqTk!/b/dL8AAAAAAAAA&amp;bo=lAE1AQAAAAADB4M!&amp;rf=viewer_4" alt=""></p>
<ol>
<li>response是一个’scrapy.http.response.html.HtmlResponse’的对象,内有两个重要的网页提取方法css和xpath</li>
<li>提取出来的数据是一个’selector’或者是’selectorList’的对象,如果想获取其中的字符串那应该执行getall或者get方法<ul>
<li>getall方法:获取selector中的所有文本,返回一个列表</li>
<li>获取的是selector中的第一个文本</li>
</ul>
</li>
<li>如果在spider中请求的数据解析完成之后需要传给Piplines处理,那么可以使用yield将解析函数变成一个生成器,或者是可以收集所有的item,最后使用return返回.</li>
<li>建议在Item中定义好数据模型.</li>
<li>Piplines:专门用来保存数据,其中有三个经常用到的方法:<ol>
<li>open_spider(self,spider):当爬虫打开的时候执行</li>
<li>process_item(self,item,spider):当爬虫有(item)数据传过来时候会被调用</li>
<li>close_spider(self,spider):当爬虫关闭的时候会被调用</li>
<li>写完Pipline之后必须在setting中配置激活</li>
<li>Pipline激活是一个字典,该字典中的值表示,piplines的优先级</li>
</ol>
</li>
</ol>
<p>激活PipLines</p>
<pre><code>ITEM_PIPELINES = {
    &#39;QiuShiBaiKe.pipelines.QiushibaikePipeline&#39;: 300,
}
</code></pre>
            </div>
            <hr>

            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">转载请注明: </span>
                    <a href="https://codinglife.site" class="b-link-green">程序员小黑</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2018/12/27/scrapy-pa-qu-qiu-shi-bai-ke/" class="b-link-green">Scrapy爬取糗事百科</a>
                </p>
            </div>
        </div>
    </div>

    

    

    

    
    <div class="livere-card card" data-aos="fade-up">
    <!-- 来必力City版安装代码 -->
    <div id="lv-container" class="card-content" data-id="city" data-uid="MTAyMC80MDk0NC8xNzQ2OQ==">
        <script type="text/javascript">
            (function (d, s) {
                let j, e = d.getElementsByTagName(s)[0];
                if (typeof LivereTower === 'function') {
                    return;
                }

                j = d.createElement(s);
                j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                j.async = true;

                e.parentNode.insertBefore(j, e);
            })(document, 'script');
        </script>
        <noscript>为正常使用来必力评论功能请激活JavaScript。</noscript>
    </div>
    <!-- City版安装代码已完成 -->
</div>
    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">本篇</div>
            <div class="card">
                <a href="/2018/12/27/scrapy-pa-qu-qiu-shi-bai-ke/">
                    <div class="card-image">
                        
                        <img src="http://m.qpic.cn/psb?/V10Lajvl1FgUNv/PPWwoLRM4bzhkfUzCwJU5MdXYSnbp0s9dmORMQAIUDs!/b/dDQBAAAAAAAA&amp;bo=CwU4BAAAAAARBwI!&amp;rf=viewer_4" class="responsive-img" alt="Scrapy爬取糗事百科">
                        
                        <span class="card-title">Scrapy爬取糗事百科</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">结果展示{&quot;author&quot;: &quot;毒男·i&quot;, &quot;content&quot;: &quot;\n\n\n在医院里，我和老婆抱着孩子去看病。老婆说：“你说女人要不要学一点防狼术。”我说：“需要啊</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2018-12-27
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python/" class="post-category" target="_blank">
                                    Python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python爬虫/" target="_blank">
                        <span class="chip bg-color">Python爬虫</span>
                    </a>
                    
                    <a href="/tags/Scrapy/" target="_blank">
                        <span class="chip bg-color">Scrapy</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">下一篇</div>
            <div class="card">
                <a href="/2018/12/26/yin-xing-shi-ru-he-jin-xing-zhuan-qian-de/">
                    <div class="card-image">
                        
                        <img src="http://m.qpic.cn/psb?/V10Lajvl1FgUNv/SgtRzVTO0Rcul.cE1NID0N2DNeo6Wke5DnpUjhvSaQM!/b/dL4AAAAAAAAA&amp;bo=AAVVAwAAAAARB2M!&amp;rf=viewer_4" class="responsive-img" alt="银行是如何进行赚钱的">
                        
                        <span class="card-title">银行是如何进行赚钱的</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">转载自&lt;得到APP&gt;香帅的金融课
银行是如何进行赚钱的。银行吸收的存款和放出去的贷款中间的利率差额叫做存贷差,是银行最重要的利润开源
货币基金货币基金它吸收的是老百姓的零钱， 投向利率比较高的银行间货币市场， 等于说货币基金帮助</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2018-12-26
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/金融/" class="post-category" target="_blank">
                                    金融
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/银行/" target="_blank">
                        <span class="chip bg-color">银行</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>
    

</main>

<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            自豪的采用Hexo
        </div>
        <div class="col s12 m4 l4 social-link"><a href="https://github.com/liu726301387" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
    <i class="fa fa-github"></i>
</a>
<a href="mailto:this.liu@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
    <i class="fa fa-envelope-open"></i>
</a>
<a href="#!" class="tooltipped" data-tooltip="QQ联系我: 726301387" data-position="top" data-delay="50">
    <i class="fa fa-qq"></i>
</a>

<a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
    <i class="fa fa-rss"></i>
</a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title">搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input" autofocus>
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/js/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":130,"height":200},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>